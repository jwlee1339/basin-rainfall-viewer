# 水庫集水區雨量觀測展示網頁 (Reservoir Catchment Rainfall Viewer)

這是一個網頁應用程式，用於視覺化展示台灣特定水庫集水區的降雨資料。使用者可以選擇水庫、日期範圍，並在互動式圖表和地圖上查看各雨量站的時間序列資料。

## 功能特色 (Features)

*   **資料篩選與控制**:
    *   選擇水庫 (目前支援翡翠、石門水庫)。
    *   選擇起始日期與顯示天數 (1-7天)。
    *   在「單一測站」與「所有測站」模式間切換。
    *   開啟/關閉「集水區平均雨量」線圖。

*   **互動式圖表 (Chart.js)**:
    *   以長條圖顯示各測站每小時雨量，並以折線圖顯示平均雨量。
    *   滑鼠懸停時顯示詳細數值。
    *   右上角即時顯示當前時間範圍內的「期間平均總雨量」。
    *   可將圖表匯出為 PNG 圖片。

*   **互動式地圖 (Leaflet)**:
    *   顯示集水區邊界與所有雨量站位置。
    *   提供多種底圖切換 (街道圖、衛星圖、地形圖、台灣通用電子地圖等)。
    *   **智慧標記顏色**: 測站標記會根據其在選定時間內的總雨量，動態顯示不同顏色 (橘色: 高於平均, 藍色: 低於平均, 灰色: 無資料)，並提供圖例說明。
    *   **地圖與圖表連動**：
        *   點擊地圖上的測站圖標，可直接切換圖表至該測站資料。
        *   在「所有測站」模式下，滑鼠懸停在地圖圖標上，會對應突顯圖表中的數據系列。
    *   提供比例尺、滑鼠座標顯示、返回預設視野 (Home) 等輔助功能。

*   **智慧分析與版面配置**:
    *   **自動跳轉至最大降雨日**: 網頁載入後，會自動分析並跳轉至該年度「集水區平均日雨量」最大的一天。
    *   「尋找日雨量排行」功能，可依「集水區平均」或「單一測站最大值」找出前三大降雨日。
    *   「切換版面」按鈕，支援「左右並排」與「上下堆疊」兩種佈局，適應不同螢幕尺寸。

*   **詳細數據表格**:
    *   以表格形式展示篩選範圍內的所有測站每小時數據。
    *   自動標示範圍內雨量前三高的數值。
    *   表格底部提供各測站的總雨量統計。
    *   可將表格資料下載為 CSV 檔案。

---

## 技術堆疊 (Technologies Used)

*   **前端**: HTML, CSS, JavaScript (ES6+)
*   **框架/函式庫**:
    *   Bootstrap 5 - UI 框架與版面配置
    *   Chart.js - 互動式圖表繪製
    *   Leaflet.js - 互動式地圖繪製
    *   date-fns (via chartjs-adapter) - Chart.js 日期時間處理

---

## 專案結構 (Project Structure)

```
/
├── index.html          # 主要 HTML 頁面
├── style.css           # 主要樣式表
├── app.js              # 主要 JavaScript 邏輯
└── rain_data/
    ├── 05/             # 石門水庫 (代碼 05)
    │   ├── 05_2023-01-01.csv       # 2023 年所有測站的每小時雨量
    │   ├── Area.json             # 集水區邊界座標
    │   └── rstbase.json          # 雨量站基本資料 (名稱、座標)
    └── 09/             # 翡翠水庫 (代碼 09)
        └── ... (結構同上)
```

## 資料來源 (Data Source)

本專案使用的降雨資料來源於**中央氣象署**的開放資料平台，經過預處理後儲存於 `rain_data` 目錄下。集水區平均雨量是在前端由所有測站資料即時動態計算而得。
